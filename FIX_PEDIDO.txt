â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          í´§ CORRECCIÃ“N DEL ERROR AL CREAR PEDIDO               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

í³‹ PROBLEMA IDENTIFICADO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Error: SQLSTATE[HY093]: Invalid parameter number

í´ CAUSA RAÃZ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Nombre de parÃ¡metro incorrecto:
   âŒ CheckoutController enviaba: 'estado_id' => 1
   âœ… Pedido.php esperaba: 'estado_pedido_id' => 1

2. Faltaba el campo 'descuento':
   âŒ CheckoutController NO lo enviaba
   âœ… Pedido.php lo requerÃ­a (aunque con valor por defecto)

í» ï¸ SOLUCIÃ“N APLICADA:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Archivo: src/app/Controllers/CheckoutController.php
LÃ­neas: 188-199

ANTES:
------
$datosPedido = [
    'usuario_id' => $usuarioId,
    'total' => $total,
    'subtotal' => $subtotal,
    'impuestos' => $impuestos,
    'metodo_pago_id' => $metodoPagoId,
    'tipo_pedido' => 'online',
    'observaciones' => $observaciones,
    'items' => $items,
    'estado_id' => 1 // âŒ INCORRECTO
];

DESPUÃ‰S:
--------
$datosPedido = [
    'usuario_id' => $usuarioId,
    'total' => $total,
    'subtotal' => $subtotal,
    'descuento' => 0, // âœ… AGREGADO
    'impuestos' => $impuestos,
    'metodo_pago_id' => $metodoPagoId,
    'estado_pedido_id' => 1, // âœ… CORREGIDO
    'tipo_pedido' => 'online',
    'observaciones' => $observaciones,
    'items' => $items
];

âœ… VERIFICACIÃ“N DE LA BASE DE DATOS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tabla: pedidos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Campo              | Tipo       | Null | Default
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
numero_pedido      | varchar    | NO   | -
usuario_id         | int(11)    | NO   | -
empleado_id        | int(11)    | YES  | NULL
total              | decimal    | NO   | -
subtotal           | decimal    | NO   | -
descuento          | decimal    | YES  | 0.00 âœ…
impuestos          | decimal    | YES  | 0.00 âœ…
metodo_pago_id     | int(11)    | NO   | -
estado_pedido_id   | int(11)    | NO   | - âœ…
tipo_pedido        | enum       | NO   | online
observaciones      | text       | YES  | NULL

Estado PENDIENTE (id=1) verificado: âœ… Existe

í¾¯ MAPEO DE PARÃMETROS CORREGIDO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CheckoutController â†’ Pedido.php â†’ Base de datos
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
'usuario_id'         â†’ :usuario_id        â†’ usuario_id âœ…
'total'              â†’ :total              â†’ total âœ…
'subtotal'           â†’ :subtotal           â†’ subtotal âœ…
'descuento'          â†’ :descuento          â†’ descuento âœ…
'impuestos'          â†’ :impuestos          â†’ impuestos âœ…
'metodo_pago_id'     â†’ :metodo_pago_id     â†’ metodo_pago_id âœ…
'estado_pedido_id'   â†’ :estado_pedido_id   â†’ estado_pedido_id âœ…
'tipo_pedido'        â†’ :tipo_pedido        â†’ tipo_pedido âœ…
'observaciones'      â†’ :observaciones      â†’ observaciones âœ…

í³¦ ESTRUCTURA DE ITEMS (sin cambios):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Cada item contiene:
- producto_id: ID del producto
- cantidad: Cantidad solicitada
- precio: Precio unitario (con oferta si aplica)

í·ª PRUEBAS RECOMENDADAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. âœ… Ir a: http://localhost/mayra/src/public/checkout
2. âœ… Seleccionar direcciÃ³n de envÃ­o
3. âœ… Seleccionar mÃ©todo de pago
4. âœ… Hacer clic en "Finalizar Pedido"
5. âœ… Verificar que:
   - Se crea el pedido correctamente
   - Se abre WhatsApp con el mensaje
   - El pedido aparece con estado PENDIENTE
   - Se vacÃ­a el carrito

í´„ FLUJO COMPLETO DESPUÃ‰S DE LA CORRECCIÃ“N:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Usuario finaliza checkout
2. CheckoutController envÃ­a datos correctos
3. Pedido.php crea registro con TODOS los campos
4. Se insertan detalles del pedido
5. Se reduce el stock
6. Se genera mensaje WhatsApp encriptado
7. Se vacÃ­a el carrito
8. Se retorna URL de WhatsApp
9. Frontend abre WhatsApp
10. Usuario envÃ­a mensaje al negocio

í³Š ESTADO DEL SISTEMA:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Base de datos: Estructura correcta
âœ… Modelo Pedido.php: Sin cambios (estaba correcto)
âœ… CheckoutController.php: CORREGIDO
âœ… Estados de pedido: Configurados correctamente
âœ… Sistema WhatsApp: Funcional

í¾‰ RESULTADO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

El error "Invalid parameter number" estÃ¡ SOLUCIONADO.
Ahora puedes crear pedidos correctamente desde el checkout.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Fecha de correcciÃ³n: 26 de octubre de 2025
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
